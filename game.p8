pico-8 cartridge // http://www.pico-8.com
version 42
__lua__
-- el viaje de freson
-- festino a., sancristobal f.

function _init()
	ents = {}
	chorros = {}
	ladridos = {}
	hambre = 100

	--setup jugador
	jug = make_freson()

	--setup chorro
	ch1 = make_chorro()
	camx = 0
	camy = 0
	actual = rndscreen(nil, nil)
end

function _draw()
	cls()

	for e in all(ents) do
		e.drw()
	end

	for l in all(ladridos) do
		circ(jug.x + 16, jug.y + 8, l.r1, 7) -- cれとrculo exterior
		circ(jug.x + 16, jug.y + 8, l.r2, 7) -- cれとrculo interior
	end
	print("ladridos: " .. #ladridos)
end

function _update()
	for e in all(ents) do
		e.upd()
	end

	for l in all(ladridos) do
		l.r1 += 2 -- el cれとrculo exterior crece
		l.r2 += 1 -- el cれとrculo interior crece mれくs lento

		-- eliminar ladrido cuando el cれとrculo exterior supera tamaれねo
		if l.r1 > 30 then
			del(ladridos, l)
		end
	end

	cls(5)
	--camx=(x\128)*128
	--camy=(y\128)*128

	--dibujar pantalla
	for i = 0, 255 do
		local tx = i * 16 * 8
		local ty = i \ 16 * 8
		spr(actual.cont[i + 1], tx, ty)
	end

	--cambio de pantalla
	local dir = nil
	if (x < -4) then
		--izq
		dir = "l"
	elseif (x > 124) then
		--der
		dir = "r"
	end

	if (y < -4) then
		--arriba
		dir = "u"
	elseif (y > 124) then
		--abajo
		dir = "d"
	end

	if dir != nil then
		local sig = actual[dir]

		if (sig == nil) then
			actual[dir] = rndscreen(actual, dir)
			sig = actual[dir]
		end
		actual = sig
	end

	--posicion
	if dir == "l" or dir == "r" then
		if (x < 0) then
			x = 124
		elseif x > 124 then
			x = -4
		end
	else
		if (y < 0) then
			y = 124
		elseif y > 124 then
			y = -4
		end
	end

	--camera(camx,camy)
	--map()
	spr(s, x, y, 2, 2)
end

function rndscreen(ant, dir)
	local pantalla = {}

	pantalla.u = nil
	pantalla.d = nil
	pantalla.l = nil
	pantalla.r = nil

	local dirs = {
		r = "l",
		l = "r",
		u = "d",
		d = "u"
	}

	if (dir != nil) then
		pantalla[dirs[dir]] = ant
	end

	pantalla.cont = {}
	local sprites = { 65, 66, 69 }

	for i = 1, 256 do
		add(pantalla.cont, rnd(sprites))
	end

	return pantalla
end

-->8
-- entidades
function make_entity()
	local e = {}
	e.x = 0
	e.y = 0
	e.s = 0
	e.dx = 0
	e.dy = 0
	e.fr = nil
	e.stat = nil

	add(ents, e)
	return e
end

-- freson
function make_freson()
	local e = make_entity()
	e.s = 1
	e.fh = true
	e.fr = {
		walk = { 1, 3, 5 },
		idle = { 1 }
	}

	local idle = "idle"
	local walk = "walk"
	e.stat = idle

	local velfreson = 1.25

	e.upd = function()
		e.stat = idle
		e.dx = 0
		if btn(⬅️) then
			e.fh = false
			e.stat = walk
			e.dx = -velfreson
		end

		if btn(➡️) then
			e.fh = true
			e.stat = walk
			e.dx = velfreson
		end

		if (btn(⬆️)) e.y -= 1
		if (btn(⬇️)) e.y += 1
		e.x += e.dx
		
		if btnp(❎) and #ladridos < 1 then
			make_ladrido()
		end
	end

	e.drw = function()
		local sps = e.fr[e.stat]
		e.s += .30

		if flr(e.s) > #sps then
			e.s = 1
		end
		--fondo transparente
		palt(0, false)
		palt(11, true)
		--dibujar freson
		spr(sps[flr(e.s)], e.x + 8, e.y, 2, 2, e.fh)
		palt()
	end

	return e
end

-- funciれはn para crear un ladrido (ondas concれたntricas)
function make_ladrido()
	local l = {}
	-- radio del cれとrculo exterior
	l.r1 = 5
	-- radio del cれとrculo interior
	l.r2 = 3
	add(ladridos, l)
end

-- chorro
function make_chorro()
	local e = make_entity()
	e.s = 33
	e.fh = false
	e.fr = {
		walk = { 33 },
		idle = { 33 }
	}

	local idle = "idle"
	local walk = "walk"
	e.stat = idle

	local velchorro = 1.5

	e.upd = function()
		e.stat = idle
	end

	e.drw = function()
		local sps = e.fr[e.stat]
		e.s += .15

		if flr(e.s) > #sps then
			e.s = 1
		end
		--fondo transparente
		palt(0, false)
		palt(11, true)
		--dibujar chorro
		spr(
			sps[flr(e.s)],
			e.x + 78,
			e.y,
			2, 2,
			e.fh
		)
		palt()
	end

	return e
end

__gfx__
00000000bbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbb000000000000000000000000000000000000000000000000000000000000000000000000
00000000bbbffffff9bb666bbbbbbbbbbbbb666bbbbbbbbbbbbb666b000000000000000000000000000000000000000000000000000000000000000000000000
00700700bb494444494bbff6bbffffff9bbbbffbbffffff9bbbbbff6000000000000000000000000000000000000000000000000000000000000000000000000
00077000b994ffff449bbbfbb494444494bbbbf4494444494bbbbbff000000000000000000000000000000000000000000000000000000000000000000000000
00077000bf990ff0999bbffbb94ffff449fbbff994ffff449ffbbffb000000000000000000000000000000000000000000000000000000000000000000000000
00700700bf4949949f666f49b990ff0999666f49990ff09996666f4b000000000000000000000000000000000000000000000000000000000000000000000000
00000000b9f990099f64444fb4949949f64444444949949f6444444f000000000000000000000000000000000000000000000000000000000000000000000000
00000000bb4f4444ff44444fbf990099f644444ff990099f6444444f000000000000000000000000000000000000000000000000000000000000000000000000
00000000bb66f9fff4444449b4f4444ff44444444f4444ff44444444000000000000000000000000000000000000000000000000000000000000000000000000
00000000bbb444444444444bbb6f9fff4444444bb6f9fff44444444f000000000000000000000000000000000000000000000000000000000000000000000000
00000000bbb544444444444bbb44444444544449b944444444444449000000000000000000000000000000000000000000000000000000000000000000000000
00000000bbb5444445544449bb44444445b5444bbb4444444554444b000000000000000000000000000000000000000000000000000000000000000000000000
00000000bbb445445b554449b444bb445bbb444bbbb444545b55445b000000000000000000000000000000000000000000000000000000000000000000000000
00000000bbb4554bbbb54544b44bb44bbbbb4b44bbbb4bb4bbb4bb4b000000000000000000000000000000000000000000000000000000000000000000000000
00000000bbb4bb4bbbbb4b54b45bd4bbbbbd6bb9bbbb44b44bd6b44b000000000000000000000000000000000000000000000000000000000000000000000000
00000000bbddb99bbb669b5994bbbbbbbbbbbbbbbbbbb9bb5bbbb9bb000000000000000000000000000000000000000000000000000000000000000000000000
00000000bbbbbbbbbbbbbbbb00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000bb222222bbbbbbbb00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000b222e22222bbbbbb00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000b8e880e2e2bbbbbb00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000bf77ff77f2bbbbbb00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000bf07ff07f2bbbbbb00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000bbfffffff2bbbbbb00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000bbff000f22bbbbbb00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000bbbffff22bbbbbbb00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000bbbb2222bbbbbbbb00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000bbbf222fbbbbbbbb00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000bbbb22f2bbbbbbbb00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000bbbbdbbdbbbbbbbb00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000bbb50b50bbbbbbbb00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000bbbbbbbbbbbbbbbb00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000bbbbbbbbbbbbbbbb00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
__label__
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000000000000000000000000000000000000000000000000000000666009ffffff0000000000000000000000000000000000000000000000000000000
0000000000000000000000000000000000000000000000000000000000006ff00494444494000000000000000000000000000000000000000000000000000000
000000000000000000000000000000000000000000000000000000000000ff000944ffff49900000000000000000000000000000000000000000000000000000
0000000000000000000000000000000000000000000000000000000000000ff009990ff099f00000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000004f666f9499494f00000000000000000000000000000000000000000000000000000
000000000000000000000000000000000000000000000000000000000000f44446f990099f900000000000000000000000000000000000000000000000000000
000000000000000000000000000000000000000000000000000000000000f44444ff4444f4000000000000000000000000000000000000000000000000000000
0000000000000000000000000000000000000000000000000000000000004444444fff9f66000000000000000000000000000000000000000000000000000000
000000000000000000000000000000000000000000000000000000000000f4444444444440000000000000000000000000000000000000000000000000000000
000000000000000000000000000000000000000000000000000000000000f4444444444450000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000094444554444450000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000094445505445440000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000044545000045540000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000045040000040040000000000000000000000000000000000000000000000000000000
000000000000000000000000000000000000000000000000000000000000950966000990dd000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000

